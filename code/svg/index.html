<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:type" content="website"><meta name="description" content="Bienvenido a nuestro portal de diseño de aplicaciones. STVAER. Representamos tu diseño al futuro. Cotiza con nosotros...">
    <title>SVGApp</title>
    <link rel="icon" type="image/x-icon" href="_assets/images/68fa745dc5d97ee2714f54f267f845b0.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-color: #000;
            background-image: 
                linear-gradient(rgba(255, 255, 255, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255, 255, 255, 0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            font-family: 'Inter', sans-serif;
        }

        .app-container {
            background-color: #333;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
        }

        .preview-container {
            background-color: #222;
            background-image: 
                linear-gradient(45deg, #2a2a2a 25%, transparent 25%),
                linear-gradient(-45deg, #2a2a2a 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #2a2a2a 75%),
                linear-gradient(-45deg, transparent 75%, #2a2a2a 75%);
            background-size: 20px 20px;
            background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        .code-container {
            background-color: #1a1a1a;
            color: #f0f0f0;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
            font-size: 16px; /* Aumentado a 16px según lo solicitado */
        }

        .custom-range::-webkit-slider-thumb {
            background: white;
        }

        .custom-range::-moz-range-thumb {
            background: white;
        }

        /* Optimizaciones para móvil */
        @media (max-width: 640px) {
            .app-container {
                margin: 0;
                border-radius: 0;
                min-height: 100vh;
            }
            
            .preview-container {
                height: 200px; /* Altura reducida en móviles */
            }
            
            .code-container {
                max-height: 200px; /* Altura reducida en móviles */
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .action-buttons button {
                width: 100%;
            }
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-0 sm:p-4">
    <div class="app-container w-full max-w-4xl rounded-lg overflow-hidden">
        <!-- Header -->
        <div class="bg-black p-4 flex justify-between items-center">
            <h1 class="text-white text-xl font-bold">SVGApp</h1>
            <div class="flex space-x-2">
                <div class="w-3 h-3 rounded-full bg-red-500"></div>
                <div class="w-3 h-3 rounded-full bg-yellow-500"></div>
                <div class="w-3 h-3 rounded-full bg-green-500"></div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="p-4 sm:p-6">
            <!-- Upload Section -->
            <div class="mb-6">
                <div class="border-2 border-dashed border-gray-400 rounded-lg p-4 sm:p-8 text-center cursor-pointer hover:border-white transition-colors" id="dropArea">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 sm:h-12 sm:w-12 mx-auto text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                    </svg>
                    <p class="mt-2 text-gray-300">Arrastra y suelta tu imagen PNG aquí</p>
                    <p class="text-gray-500 text-sm mt-1">o</p>
                    <label class="mt-2 inline-block px-4 py-2 bg-white text-black rounded cursor-pointer hover:bg-gray-200 transition-colors">
                        Seleccionar archivo
                        <input type="file" id="fileInput" class="hidden" accept="image/png,image/jpeg,image/gif">
                    </label>
                </div>
            </div>

            <!-- Preview Section -->
            <div class="mb-6">
                <h2 class="text-white text-lg font-semibold mb-2">Imagen Original</h2>
                <div class="preview-container rounded-lg flex items-center justify-center h-48 sm:h-64 overflow-hidden">
                    <img id="originalPreview" class="max-w-full max-h-full hidden" alt="Vista previa">
                    <p id="noImageText" class="text-gray-400">No hay imagen cargada</p>
                </div>
                <div class="mt-2 text-gray-400 text-sm">
                    <span id="imageInfo">-</span>
                </div>
            </div>

            <!-- Settings Section -->
            <div class="bg-gray-800 rounded-lg p-4 mb-6">
                <h2 class="text-white text-lg font-semibold mb-3">Configuración SVG</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-300 mb-1 text-sm">Calidad (Compresión)</label>
                        <div class="flex items-center">
                            <input type="range" min="1" max="5" value="3" class="custom-range w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer" id="qualitySlider">
                            <span class="text-white ml-2 w-6 text-center" id="qualityValue">3</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-1 text-sm">Tamaño de salida</label>
                        <div class="flex items-center">
                            <input type="range" min="50" max="200" value="100" class="custom-range w-full h-2 bg-gray-600 rounded-lg appearance-none cursor-pointer" id="sizeSlider">
                            <span class="text-white ml-2 w-8 text-center" id="sizeValue">100%</span>
                        </div>
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-1 text-sm">Decimales</label>
                        <select id="decimalSelect" class="bg-gray-700 text-white rounded px-3 py-1 w-full">
                            <option value="2" selected>2 (Recomendado)</option>
                            <option value="1">1</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-300 mb-1 text-sm">Optimización</label>
                        <select id="optimizeSelect" class="bg-gray-700 text-white rounded px-3 py-1 w-full">
                            <option value="minimal">Minimizar y flexible</option>
                            <option value="precision">Máxima precisión</option>
                            <option value="size">Tamaño mínimo</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Code Output Section -->
            <div class="mb-6">
                <div class="flex justify-between items-center mb-2">
                    <h2 class="text-white text-lg font-semibold">Código SVG</h2>
                    <button id="copyButton" class="bg-white text-black px-3 py-1 rounded hover:bg-gray-200 transition-colors flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
                        </svg>
                        Copiar
                    </button>
                </div>
                <div class="code-container rounded-lg p-4 text-base" id="svgCode">
                    <!-- El código SVG se mostrará aquí -->
                    <span class="text-gray-500">No hay código SVG generado</span>
                </div>
                <div class="mt-2 text-gray-400 text-sm">
                    <span id="svgInfo">-</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row justify-end space-y-3 sm:space-y-0 sm:space-x-3">
                <button id="resetButton" class="w-full sm:w-auto px-4 py-2 bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors">
                    Reiniciar
                </button>
                <button id="convertButton" class="w-full sm:w-auto px-4 py-2 bg-white text-black rounded hover:bg-gray-200 transition-colors" disabled>
                    Convertir a SVG
                </button>
            </div>
            
            <!-- Footer -->
            <div class="mt-8 text-center text-gray-500 text-sm border-t border-gray-700 pt-4">
                © 2025 Diseñado por STVAER </> Code.
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const dropArea = document.getElementById('dropArea');
            const originalPreview = document.getElementById('originalPreview');
            const noImageText = document.getElementById('noImageText');
            const imageInfo = document.getElementById('imageInfo');
            const svgInfo = document.getElementById('svgInfo');
            const svgCode = document.getElementById('svgCode');
            const convertButton = document.getElementById('convertButton');
            const resetButton = document.getElementById('resetButton');
            const copyButton = document.getElementById('copyButton');
            const qualitySlider = document.getElementById('qualitySlider');
            const qualityValue = document.getElementById('qualityValue');
            const sizeSlider = document.getElementById('sizeSlider');
            const sizeValue = document.getElementById('sizeValue');
            
            let currentImage = null;
            let imageWidth = 0;
            let imageHeight = 0;
            let imageType = '';
            let rawImageData = '';
            
            // Event listeners para arrastrar y soltar
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('border-white');
                dropArea.classList.remove('border-gray-400');
            }
            
            function unhighlight() {
                dropArea.classList.remove('border-white');
                dropArea.classList.add('border-gray-400');
            }
            
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                if (files.length) {
                    handleFiles(files);
                }
            }
            
            fileInput.addEventListener('change', function() {
                if (fileInput.files.length) {
                    handleFiles(fileInput.files);
                }
            });
            
            function handleFiles(files) {
                const file = files[0];
                if (file.type.match('image.*')) {
                    imageType = file.type;
                    
                    // Leer como URL de datos para la vista previa
                    const readerForPreview = new FileReader();
                    readerForPreview.onload = function(e) {
                        currentImage = e.target.result;
                        displayImage(currentImage, file);
                    };
                    readerForPreview.readAsDataURL(file);
                    
                    // Leer como ArrayBuffer para procesar los datos binarios
                    const readerForData = new FileReader();
                    readerForData.onload = function(e) {
                        const arrayBuffer = e.target.result;
                        const byteArray = new Uint8Array(arrayBuffer);
                        
                        // Convertir a base64 sin el prefijo de data URL
                        rawImageData = arrayBufferToBase64(byteArray);
                    };
                    readerForData.readAsArrayBuffer(file);
                } else {
                    alert('Por favor, selecciona una imagen.');
                }
            }
            
            function arrayBufferToBase64(buffer) {
                let binary = '';
                const bytes = new Uint8Array(buffer);
                const len = bytes.byteLength;
                for (let i = 0; i < len; i++) {
                    binary += String.fromCharCode(bytes[i]);
                }
                return window.btoa(binary);
            }
            
            function displayImage(src, file) {
                // Cargar la imagen para obtener dimensiones
                const img = new Image();
                img.onload = function() {
                    imageWidth = this.width;
                    imageHeight = this.height;
                    
                    // Mostrar la imagen
                    originalPreview.src = src;
                    originalPreview.classList.remove('hidden');
                    noImageText.classList.add('hidden');
                    
                    // Mostrar información de la imagen
                    const fileSizeKB = Math.round(file.size / 1024);
                    imageInfo.textContent = `${file.name} (${fileSizeKB} KB) - ${imageWidth}x${imageHeight}px`;
                    
                    // Habilitar botón de conversión
                    convertButton.disabled = false;
                    
                    // Limpiar código SVG
                    svgCode.innerHTML = '<span class="text-gray-500">Haz clic en "Convertir a SVG" para generar el código</span>';
                    svgInfo.textContent = '-';
                };
                img.src = src;
            }
            
            // Actualizar valores de los sliders
            qualitySlider.addEventListener('input', function() {
                qualityValue.textContent = this.value;
            });
            
            sizeSlider.addEventListener('input', function() {
                sizeValue.textContent = `${this.value}%`;
            });
            
            // Botón de conversión
            convertButton.addEventListener('click', convertToSVG);
            
            function convertToSVG() {
                if (!currentImage || !rawImageData) return;
                
                // Obtener los parámetros de configuración
                const quality = parseInt(qualitySlider.value);
                const size = parseInt(sizeSlider.value) / 100;
                const decimals = parseInt(document.getElementById('decimalSelect').value);
                const optimize = document.getElementById('optimizeSelect').value;
                
                // Generar un ID único para los elementos SVG
                const uniqueId = 'uuid-' + generateUUID();
                
                // Calcular las dimensiones finales y el factor de escala
                const scaleFactor = size.toFixed(decimals);
                const finalWidth = (imageWidth * size).toFixed(decimals);
                const finalHeight = (imageHeight * size).toFixed(decimals);
                
                // Determinar el tipo MIME para el base64
                let mimeType = 'image/png';
                if (imageType) {
                    mimeType = imageType;
                }
                
                // Crear el SVG con el formato XML correcto y la imagen incrustada
                let svgContent = `<?xml version="1.0" encoding="UTF-8"?>
<svg id="${uniqueId}" data-name="Capa 1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 ${finalWidth} ${finalHeight}">
  <image width="${imageWidth}" height="${imageHeight}" transform="scale(${scaleFactor})" xlink:href="data:${mimeType};base64,${rawImageData}"/>
</svg>`;
                
                // Aplicar optimización según la configuración
                if (optimize === 'size') {
                    // Minimizar el SVG eliminando espacios en blanco innecesarios
                    svgContent = svgContent.replace(/>\s+</g, '><')
                        .replace(/\s+>/g, '>')
                        .replace(/<\s+/g, '<')
                        .replace(/\n\s*/g, '');
                }
                
                // Mostrar el código
                svgCode.textContent = svgContent;
                
                // Calcular tamaño aproximado del SVG
                const svgSizeKB = Math.round((svgContent.length / 1024) * 10) / 10;
                svgInfo.textContent = `SVG generado (${svgSizeKB} KB) - ${finalWidth}x${finalHeight}px`;
                
                // Hacer scroll al área de código en dispositivos móviles
                if (window.innerWidth < 640) {
                    svgCode.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
            
            // Función para generar UUID
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0;
                    const v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }
            
            // Botón de copiar - Asegurando que funcione correctamente
            copyButton.addEventListener('click', function() {
                const codeText = svgCode.textContent;
                if (codeText && !codeText.includes('No hay código')) {
                    // Crear un elemento textarea temporal para copiar el texto
                    const textarea = document.createElement('textarea');
                    textarea.value = codeText;
                    textarea.setAttribute('readonly', '');
                    textarea.style.position = 'absolute';
                    textarea.style.left = '-9999px';
                    document.body.appendChild(textarea);
                    
                    // Seleccionar y copiar el texto
                    textarea.select();
                    document.execCommand('copy');
                    
                    // Eliminar el textarea temporal
                    document.body.removeChild(textarea);
                    
                    // Usar la API moderna de portapapeles si está disponible
                    if (navigator.clipboard && window.isSecureContext) {
                        navigator.clipboard.writeText(codeText).catch(err => {
                            console.error('No se pudo copiar el texto: ', err);
                        });
                    }
                    
                    // Cambiar el texto del botón temporalmente para dar feedback
                    const originalText = copyButton.innerHTML;
                    copyButton.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                        Copiado!
                    `;
                    setTimeout(() => {
                        copyButton.innerHTML = originalText;
                    }, 2000);
                }
            });
            
            // Botón de reinicio
            resetButton.addEventListener('click', function() {
                currentImage = null;
                imageWidth = 0;
                imageHeight = 0;
                imageType = '';
                rawImageData = '';
                originalPreview.classList.add('hidden');
                noImageText.classList.remove('hidden');
                imageInfo.textContent = '-';
                svgCode.innerHTML = '<span class="text-gray-500">No hay código SVG generado</span>';
                svgInfo.textContent = '-';
                convertButton.disabled = true;
                fileInput.value = '';
                qualitySlider.value = 3;
                qualityValue.textContent = '3';
                sizeSlider.value = 100;
                sizeValue.textContent = '100%';
                document.getElementById('decimalSelect').value = '2';
                document.getElementById('optimizeSelect').value = 'minimal';
            });
            
            // Mejorar la experiencia táctil en dispositivos móviles
            if ('ontouchstart' in window) {
                document.querySelectorAll('select, button').forEach(el => {
                    el.style.padding = '0.75rem';
                });
            }
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'93e7793e54b1d061',t:'MTc0NzAyNzI5Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</body></html>
